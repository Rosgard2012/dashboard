<% content_for :header_tags do %>
    <%= stylesheet_link_tag 'style', plugin: 'dashboard' %>
	<%= javascript_include_tag 'script', plugin: 'dashboard' %>
	<%= javascript_include_tag 'Sortable.min', plugin: 'dashboard' %>
	<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.5.0/font/bootstrap-icons.css">
<% end %>

<div class="select_project_container">
	<% @projects.each do |project| %>
		<% if project[:id].to_s == @selected_project_id.to_s %>
			<div class="select_project_item select_project_item_selected" style="background-color: <%= project[:color] %>" data-id="<%= project[:id] %>"><%= project[:name] %></div>
		<% else %>
			<div class="select_project_item" style="background-color: <%= project[:color] %>" data-id="<%= project[:id] %>"><%= project[:name] %></div>
		<% end %>
	<% end %>
</div>

<div class="issues_container">
	<% @statuses.each do |status| %>
		<div class="status_column" data-id="<%= status[:id] %>">
			<div class="status_column_header" style="border-bottom-color: <%= status[:color] %>">
				<span> <%= status[:name] %> </span>
			</div>
			<div class="<% status[:is_closed] ? ("status_column_closed_issues") : ("status_column_issues") %>">
				<% @issues.select {|issue| issue[:status_id] == status[:id] }.each do |issue| %>
					<% project_color = @projects.select {|item| item[:id] == issue[:project].id }[0][:color] %>
					<% if status[:is_closed] && Setting.plugin_dashboard['display_minimized_closed_issue_cards'] %>
						<div class="minimized_issue_card" style="border-bottom-color: <%= project_color %>" data-status="<%= status[:id] %>" data-id="<%= issue[:id] %>" onclick="goToIssue(<%= issue[:id] %>)">
							<span> <%= "#" + issue[:id].to_s %> </span>
						</div>
					<% else %>
						<div class="issue_card" data-status="<%= status[:id] %>" data-id="<%= issue[:id] %>" onclick="goToIssue(<%= issue[:id] %>)">
							<div class="issue_card_header">
								<span class="issue_card_header_date"><%= issue[:created_at] %></span>
								<div class="issue_card_header_project" style="background-color: <%= project_color %>"><%= issue[:project].name %></div>
							</div>
							<span class="issue_card_title"> <%= issue[:subject] %> </span>
							<span class="issue_card_author"><i class="bi bi-person"></i> <%= issue[:author] %> </span>
							<% if issue[:executor] == '' || issue[:executor].nil? %>
								<span class="issue_card_executor_not_set"><i class="bi bi-hammer"></i> <%=l :executor_not_set %></span>
							<% else %>
								<span class="issue_card_executor"><i class="bi bi-hammer"></i> <%= issue[:executor] %> </span>
							<% end %>
						</div>
					<% end %>
				<% end %>
			</div>
		</div>
	<% end %>
</div>

<script>
	init();
</script>